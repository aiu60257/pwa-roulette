<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>インチキルーレット</title>
<style>
  body { text-align:center; font-family: sans-serif; }
  #wheel {
    width: 300px; height: 300px; border-radius: 50%;
    border: 5px solid #333; margin: 20px auto;
    position: relative; background: conic-gradient(
      #f88 0deg 90deg,
      #8f8 90deg 180deg,
      #88f 180deg 270deg,
      #ff8 270deg 360deg
    );
    transform: rotate(0deg);
    transition: transform 4s cubic-bezier(0.17, 0.67, 0.83, 0.67);
  }
  #indicator {
    width: 0; height: 0;
    border-left: 20px solid transparent;
    border-right: 20px solid transparent;
    border-bottom: 30px solid red;
    position: absolute;
    top: -30px; left: 50%; transform: translateX(-50%);
  }
  #secretPanel {
    display: none;
    margin-top: 20px;
  }
</style>
</head>
<body>
  <h2>インチキルーレット</h2>
  <div style="position:relative; width:300px; margin:auto;">
    <div id="indicator"></div>
    <div id="wheel"></div>
  </div>
  <button onclick="spin()">回す</button>

  <div style="margin-top:30px; font-size:small;">
    （右下を長押しでパスワード入力）
  </div>

  <div id="secretPanel">
    <h3>裏設定</h3>
    強制的に止める場所:
    <select id="forceSelect">
      <option value="">なし</option>
      <option value="0">A (赤)</option>
      <option value="1">B (緑)</option>
      <option value="2">C (青)</option>
      <option value="3">D (黄)</option>
    </select>
  </div>

<script>
let wheel = document.getElementById("wheel");
let isSpinning = false;

function spin() {
  if (isSpinning) return;
  isSpinning = true;
  
  // セグメント数（A,B,C,D = 4つ）
  const segments = 4;
  const baseAngle = 360 / segments;

  // 裏設定（強制停止）
  let forceIndex = document.getElementById("forceSelect").value;
  
  // 乱数で決定
  let chosenIndex = forceIndex !== "" ? parseInt(forceIndex) : Math.floor(Math.random()*segments);

  // 真上に来る角度を計算（右回転）
  let stopAngle = 360 - (chosenIndex * baseAngle + baseAngle/2);
  
  // 不自然防止のため ±5度ランダムにずらす
  stopAngle += (Math.random()*10 - 5);

  // 5～7周してからストップ
  let spins = 360 * (5 + Math.floor(Math.random()*3));
  let finalAngle = spins + stopAngle;

  wheel.style.transition = "none";       // 初期化
  wheel.style.transform = "rotate(0deg)";
  setTimeout(()=>{
    wheel.style.transition = "transform 4s cubic-bezier(0.17,0.67,0.83,0.67)";
    wheel.style.transform = `rotate(${finalAngle}deg)`;
  },50);

  setTimeout(()=>{ isSpinning = false; }, 4500);
}

// 秘密パネル呼び出し
document.body.addEventListener("contextmenu", e => e.preventDefault()); // 長押し防止
let secretTimer;
document.body.addEventListener("touchstart", e=>{
  if (e.touches[0].clientX > window.innerWidth*0.8 && e.touches[0].clientY > window.innerHeight*0.8) {
    secretTimer = setTimeout(()=>{
      let pw = prompt("パスワードを入力");
      if (pw === "1234") {
        document.getElementById("secretPanel").style.display = "block";
      }
    },1000);
  }
});
document.body.addEventListener("touchend", ()=>clearTimeout(secretTimer));
</script>
</body>
</html>
