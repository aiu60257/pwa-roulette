<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>インチキルーレット</title>
  <style>
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      background: #f7f7f7;
      font-family: sans-serif;
    }
    canvas {
      border: 5px solid #333;
      border-radius: 50%;
    }
    #spinBtn {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 18px;
      border: none;
      border-radius: 8px;
      background: #28a745;
      color: white;
      cursor: pointer;
    }
    #spinBtn:disabled {
      background: #aaa;
      cursor: not-allowed;
    }
    /* ルーレットの上のインジケータ */
    .indicator {
      width: 0;
      height: 0;
      border-left: 20px solid transparent;
      border-right: 20px solid transparent;
      border-bottom: 30px solid red;
      margin-bottom: -15px;
      z-index: 10;
    }
  </style>
</head>
<body>
  <div class="indicator"></div>
  <canvas id="wheel" width="500" height="500"></canvas>
  <button id="spinBtn">SPIN!</button>
  <p id="result"></p>

  <script>
    const canvas = document.getElementById("wheel");
    const ctx = canvas.getContext("2d");
    const spinBtn = document.getElementById("spinBtn");
    const result = document.getElementById("result");

    // ルーレット項目
    const options = ["大当たり", "中当たり", "小当たり", "ハズレ"];
    // 見た目の分割割合 (％表記)
    const displayRatios = [1, 1, 1, 1]; 
    // 当選確率のインチキ調整 (非公開にしてもOK)
    const weights = [0.05, 0.15, 0.3, 0.5]; // 大当たり5%, 中15%, 小30%, ハズレ50%

    const colors = ["#ff4d4d", "#4da6ff", "#4dff88", "#ffdb4d"];
    let startAngle = 0;

    // ルーレット描画
    function drawWheel() {
      let total = displayRatios.reduce((a, b) => a + b, 0);
      let angle = startAngle;
      for (let i = 0; i < options.length; i++) {
        let slice = (displayRatios[i] / total) * 2 * Math.PI;
        ctx.beginPath();
        ctx.moveTo(canvas.width / 2, canvas.height / 2);
        ctx.arc(canvas.width / 2, canvas.height / 2, canvas.width / 2, angle, angle + slice);
        ctx.fillStyle = colors[i % colors.length];
        ctx.fill();
        ctx.stroke();

        // テキスト
        ctx.save();
        ctx.translate(canvas.width / 2, canvas.height / 2);
        ctx.rotate(angle + slice / 2);
        ctx.textAlign = "right";
        ctx.fillStyle = "black";
        ctx.font = "20px sans-serif";
        ctx.fillText(options[i], canvas.width / 2 - 10, 10);
        ctx.restore();

        angle += slice;
      }
    }

    drawWheel();

    // 重み付きランダム選択
    function weightedRandom(weights) {
      let sum = weights.reduce((a, b) => a + b, 0);
      let r = Math.random() * sum;
      let acc = 0;
      for (let i = 0; i < weights.length; i++) {
        acc += weights[i];
        if (r < acc) return i;
      }
      return weights.length - 1;
    }

    spinBtn.addEventListener("click", () => {
      spinBtn.disabled = true;
      result.textContent = "";

      const chosenIndex = weightedRandom(weights);
      let total = displayRatios.reduce((a, b) => a + b, 0);
      let sliceAngle = (displayRatios[chosenIndex] / total) * 2 * Math.PI;
      let stopAngle = (displayRatios.slice(0, chosenIndex).reduce((a, b) => a + b, 0) / total) * 2 * Math.PI 
                    + sliceAngle / 2;

      // 回転設定：10秒以上回してゆっくり停止
      let spins = 30; // 大回転数
      let targetAngle = spins * 2 * Math.PI - stopAngle;
      let duration = 10000; // 10秒
      let startTime = null;

      function animate(timestamp) {
        if (!startTime) startTime = timestamp;
        let elapsed = timestamp - startTime;
        let progress = Math.min(elapsed / duration, 1);
        let easeOut = 1 - Math.pow(1 - progress, 3);
        startAngle = targetAngle * easeOut;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawWheel();
        if (progress < 1) {
          requestAnimationFrame(animate);
        } else {
          result.textContent = "結果: " + options[chosenIndex];
          spinBtn.disabled = false;
        }
      }

      reque
