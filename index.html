<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>インチキルーレット</title>
  <style>
    body { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; }
    canvas { border: 2px solid #333; border-radius: 50%; }
    #spinBtn { margin-top: 20px; padding: 10px 20px; font-size: 18px; }
  </style>
</head>
<body>
  <canvas id="wheelCanvas" width="500" height="500"></canvas>
  <button id="spinBtn">回す！</button>

  <script>
    const canvas = document.getElementById("wheelCanvas");
    const ctx = canvas.getContext("2d");
    const spinBtn = document.getElementById("spinBtn");
    const size = canvas.width;
    const center = size / 2;

    // ======================
    // ルーレットの設定
    // ======================
    const segments = [
      { label: "A賞", color: "#ff9999", weight: 0.1 }, // weight = 当選確率
      { label: "B賞", color: "#99ccff", weight: 0.2 },
      { label: "C賞", color: "#99ff99", weight: 0.5 },
      { label: "ハズレ", color: "#cccccc", weight: 0.2 }
    ];
    let totalWeight = segments.reduce((s, seg) => s + seg.weight, 0);

    let angle = 0; // 現在の角度

    // ======================
    // ルーレット描画
    // ======================
    function drawWheel() {
      const arc = 2 * Math.PI / segments.length;
      ctx.clearRect(0, 0, size, size);

      // セグメント描画
      segments.forEach((seg, i) => {
        const startAngle = i * arc + angle;
        const endAngle = startAngle + arc;

        ctx.beginPath();
        ctx.moveTo(center, center);
        ctx.arc(center, center, center - 5, startAngle, endAngle);
        ctx.closePath();
        ctx.fillStyle = seg.color;
        ctx.fill();

        // テキスト
        ctx.save();
        ctx.translate(center, center);
        ctx.rotate(startAngle + arc / 2);
        ctx.textAlign = "right";
        ctx.fillStyle = "#000";
        ctx.font = "20px sans-serif";
        ctx.fillText(seg.label, center - 20, 10);
        ctx.restore();
      });

      // インジケータ（黒▼）
      ctx.beginPath();
      ctx.moveTo(center - 15, 10);
      ctx.lineTo(center + 15, 10);
      ctx.lineTo(center, 40);
      ctx.closePath();
      ctx.fillStyle = "black";
      ctx.fill();
    }

    // ======================
    // 当選決定（インチキ）
    // ======================
    function pickWinner() {
      let r = Math.random() * totalWeight;
      for (let seg of segments) {
        if (r < seg.weight) return seg;
        r -= seg.weight;
      }
    }

    // ======================
    // スピン処理
    // ======================
    function spin() {
      spinBtn.disabled = true;
      const winner = pickWinner();
      const winnerIndex = segments.indexOf(winner);
      const arc = 2 * Math.PI / segments.length;

      // 停止位置を調整（当たりセグメントの中央に止まる）
      const stopAngle = (3 * Math.PI / 2) - (winnerIndex * arc + arc / 2);

      // 10秒くらい回るように調整
      const spins = 20; // 回転数（大きいほど多く回る）
      const finalAngle = stopAngle + spins * 2 * Math.PI;

      let start = null;
      const duration = 10000; // 10秒
      const startAngle = angle;

      function animate(ts) {
        if (!start) start = ts;
        const progress = Math.min((ts - start) / duration, 1);

        // easeOutCubic
        const eased = 1 - Math.pow(1 - progress, 3);

        angle = startAngle + (finalAngle - startAngle) * eased;

        drawWheel();

        if (progress < 1) {
          requestAnimationFrame(animate);
        } else {
          alert("結果: " + winner.label);
          spinBtn.disabled = false;
        }
      }

      requestAnimationFrame(animate);
    }

    spinBtn.addEventListener("click", spin);

    drawWheel();
  </script>
</body>
</html>
